CREATE TABLE city (id SMALLINT UNSIGNED AUTO_INCREMENT, state_id SMALLINT UNSIGNED, name VARCHAR(50), INDEX state_id_idx (state_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE feedback (id INT UNSIGNED AUTO_INCREMENT, user_id INT UNSIGNED NOT NULL, name VARCHAR(80), content LONGTEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE newsletter (id INT UNSIGNED AUTO_INCREMENT, user_id INT UNSIGNED NOT NULL, title VARCHAR(150), content LONGTEXT, publish_at DATETIME, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE page (id TINYINT UNSIGNED AUTO_INCREMENT, name VARCHAR(100), content LONGTEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE state (id SMALLINT UNSIGNED AUTO_INCREMENT, name VARCHAR(50), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE student (id INT UNSIGNED AUTO_INCREMENT, user_id INT UNSIGNED UNIQUE NOT NULL, furigana VARCHAR(100), zipcode SMALLINT, address VARCHAR(150), contact VARCHAR(20), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE teacher (id INT UNSIGNED AUTO_INCREMENT, user_id INT UNSIGNED UNIQUE NOT NULL, title VARCHAR(100), portfolio LONGTEXT, details LONGTEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE teacher_student (id SMALLINT UNSIGNED AUTO_INCREMENT, teacher_id INT UNSIGNED NOT NULL, student_id INT UNSIGNED NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX teacher_id_idx (teacher_id), INDEX student_id_idx (student_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE topic (id INT UNSIGNED AUTO_INCREMENT, user_id INT UNSIGNED NOT NULL, title VARCHAR(255), pdf_filename VARCHAR(36), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE user (id INT UNSIGNED AUTO_INCREMENT, role ENUM('0', '1', '2') DEFAULT '0', status ENUM('0', '1', '2', '3', '4') DEFAULT '0', email VARCHAR(80) NOT NULL UNIQUE, password VARCHAR(32) NOT NULL, name VARCHAR(100) NOT NULL, state_id SMALLINT UNSIGNED, city_id SMALLINT UNSIGNED, request_code VARCHAR(32), login_type ENUM('0', '1', '2') DEFAULT '0', picture VARCHAR(42) NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX state_id_idx (state_id), INDEX city_id_idx (city_id), PRIMARY KEY(id)) ENGINE = INNODB;
ALTER TABLE city ADD CONSTRAINT city_state_id_state_id FOREIGN KEY (state_id) REFERENCES state(id) ON DELETE CASCADE;
ALTER TABLE feedback ADD CONSTRAINT feedback_user_id_user_id FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE;
ALTER TABLE newsletter ADD CONSTRAINT newsletter_user_id_user_id FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE;
ALTER TABLE student ADD CONSTRAINT student_user_id_user_id FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE;
ALTER TABLE teacher ADD CONSTRAINT teacher_user_id_user_id FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE;
ALTER TABLE teacher_student ADD CONSTRAINT teacher_student_teacher_id_teacher_id FOREIGN KEY (teacher_id) REFERENCES teacher(id) ON DELETE CASCADE;
ALTER TABLE teacher_student ADD CONSTRAINT teacher_student_student_id_student_id FOREIGN KEY (student_id) REFERENCES student(id) ON DELETE CASCADE;
ALTER TABLE topic ADD CONSTRAINT topic_user_id_user_id FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE;
ALTER TABLE user ADD CONSTRAINT user_state_id_state_id FOREIGN KEY (state_id) REFERENCES state(id) ON DELETE SET NULL;
ALTER TABLE user ADD CONSTRAINT user_city_id_city_id FOREIGN KEY (city_id) REFERENCES city(id) ON DELETE SET NULL;
