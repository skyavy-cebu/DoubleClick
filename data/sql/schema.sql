CREATE TABLE admin (id INT UNSIGNED AUTO_INCREMENT, name VARCHAR(100), email VARCHAR(80) NOT NULL UNIQUE, password VARCHAR(32) NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE city (id SMALLINT UNSIGNED AUTO_INCREMENT, state_id SMALLINT UNSIGNED NOT NULL, name VARCHAR(50) NOT NULL, INDEX state_id_idx (state_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE feedback (id INT UNSIGNED AUTO_INCREMENT, admin_id INT UNSIGNED NOT NULL, customer_name VARCHAR(80) NOT NULL, body TEXT, publish_date DATETIME NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX admin_id_idx (admin_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE newsletter (id INT UNSIGNED AUTO_INCREMENT, user_id INT UNSIGNED NOT NULL, title VARCHAR(150), content LONGTEXT, publish_at DATETIME, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE newsletter_admin (id INT UNSIGNED AUTO_INCREMENT, admin_id INT UNSIGNED NOT NULL, title VARCHAR(150) NOT NULL, content TEXT, publish_date DATETIME NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX admin_id_idx (admin_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE newsletter_teacher (id INT UNSIGNED AUTO_INCREMENT, teacher_id INT UNSIGNED NOT NULL, title VARCHAR(150) NOT NULL, content TEXT, publish_date DATETIME NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX teacher_id_idx (teacher_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE page (id TINYINT UNSIGNED AUTO_INCREMENT, title VARCHAR(150) NOT NULL, image1 VARCHAR(100), image2 VARCHAR(100), body TEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE state (id SMALLINT UNSIGNED AUTO_INCREMENT, name VARCHAR(50) NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE student (id INT UNSIGNED AUTO_INCREMENT, name VARCHAR(100) NOT NULL, furigana VARCHAR(100), email VARCHAR(80) NOT NULL UNIQUE, password VARCHAR(32), login_type ENUM('0', '1') DEFAULT '0' NOT NULL, zipcode1 VARCHAR(3), zipcode2 VARCHAR(4), address VARCHAR(150), state_id SMALLINT UNSIGNED, city_id SMALLINT UNSIGNED, contact VARCHAR(20), picture VARCHAR(42), status ENUM('0', '1', '2', '3', '4') DEFAULT '0' NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX state_id_idx (state_id), INDEX city_id_idx (city_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE subscription (teacher_id INT UNSIGNED, student_id INT UNSIGNED, duration ENUM('0', '1', '2') NOT NULL, valid_until DATETIME, created_at DATETIME NOT NULL, PRIMARY KEY(teacher_id, student_id)) ENGINE = INNODB;
CREATE TABLE teacher (id INT UNSIGNED AUTO_INCREMENT, title VARCHAR(100), email VARCHAR(80) NOT NULL UNIQUE, password VARCHAR(32) NOT NULL, portfolio TEXT, details TEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE topic (id INT UNSIGNED AUTO_INCREMENT, admin_id INT UNSIGNED NOT NULL, title VARCHAR(255) NOT NULL, pdf_filename VARCHAR(36) NOT NULL, publish_date DATETIME NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX admin_id_idx (admin_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE user (id INT UNSIGNED AUTO_INCREMENT, role ENUM('0', '1', '2') DEFAULT '0', status ENUM('0', '1', '2', '3', '4') DEFAULT '0', email VARCHAR(80) NOT NULL UNIQUE, password VARCHAR(32) NOT NULL, name VARCHAR(100) NOT NULL, state_id SMALLINT UNSIGNED, city_id SMALLINT UNSIGNED, request_code VARCHAR(32), login_type ENUM('0', '1', '2') DEFAULT '0', picture VARCHAR(42) NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX state_id_idx (state_id), INDEX city_id_idx (city_id), PRIMARY KEY(id)) ENGINE = INNODB;
ALTER TABLE city ADD CONSTRAINT city_state_id_state_id FOREIGN KEY (state_id) REFERENCES state(id) ON DELETE CASCADE;
ALTER TABLE feedback ADD CONSTRAINT feedback_admin_id_admin_id FOREIGN KEY (admin_id) REFERENCES admin(id) ON DELETE CASCADE;
ALTER TABLE newsletter ADD CONSTRAINT newsletter_user_id_user_id FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE;
ALTER TABLE newsletter_admin ADD CONSTRAINT newsletter_admin_admin_id_admin_id FOREIGN KEY (admin_id) REFERENCES admin(id) ON DELETE CASCADE;
ALTER TABLE newsletter_teacher ADD CONSTRAINT newsletter_teacher_teacher_id_teacher_id FOREIGN KEY (teacher_id) REFERENCES teacher(id) ON DELETE CASCADE;
ALTER TABLE student ADD CONSTRAINT student_state_id_state_id FOREIGN KEY (state_id) REFERENCES state(id) ON DELETE SET NULL;
ALTER TABLE student ADD CONSTRAINT student_city_id_city_id FOREIGN KEY (city_id) REFERENCES city(id) ON DELETE SET NULL;
ALTER TABLE subscription ADD CONSTRAINT subscription_teacher_id_teacher_id FOREIGN KEY (teacher_id) REFERENCES teacher(id) ON DELETE CASCADE;
ALTER TABLE subscription ADD CONSTRAINT subscription_student_id_student_id FOREIGN KEY (student_id) REFERENCES student(id) ON DELETE CASCADE;
ALTER TABLE topic ADD CONSTRAINT topic_admin_id_admin_id FOREIGN KEY (admin_id) REFERENCES admin(id) ON DELETE CASCADE;
ALTER TABLE user ADD CONSTRAINT user_state_id_state_id FOREIGN KEY (state_id) REFERENCES state(id) ON DELETE SET NULL;
ALTER TABLE user ADD CONSTRAINT user_city_id_city_id FOREIGN KEY (city_id) REFERENCES city(id) ON DELETE SET NULL;
